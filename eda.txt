# %% [markdown]
# # Exploratory Data Analysis: Domain and Cohort Analysis

# %% [markdown]
# ## 1. Data Preparation

# %%
# Run the data preparation script
%run data-preparation-script.py

# %% [markdown]
# ## 2. Overall Domain Analysis

# %%
# List all domains
domains = domain_map['Domain'].unique()

for domain in domains:
    print(f"\n### {domain}")
    print(summarize_domain(merged_data, domain))
    fig = plot_domain_distribution(merged_data, domain, cohorts)
    plt.show()

# %% [markdown]
# ## 3. Cohort-Specific Analysis

# %%
for cohort in cohorts:
    print(f"\n### Cohort: {cohort}")
    cohort_data = merged_data[merged_data['survey'] == cohort]
    
    print("\nDemographics:")
    print(cohort_data[['msoc_age', 'msoc_12rev']].describe())
    
    for domain in domains:
        print(f"\n{domain}:")
        print(summarize_domain(cohort_data, domain))

# %% [markdown]
# ## 4. Comparative Analysis

# %%
# Example: Compare 'msoc_age' across cohorts
fig, ax = plt.subplots(figsize=(10, 6))
sns.boxplot(x='survey', y='msoc_age', data=merged_data, ax=ax)
ax.set_title('Age Distribution Across Cohorts')
plt.show()

# Perform ANOVA
f_statistic, p_value = stats.f_oneway(
    *[group['msoc_age'].dropna() for name, group in merged_data.groupby('survey')]
)
print(f"ANOVA results for age across cohorts: F-statistic = {f_statistic:.4f}, p-value = {p_value:.4f}")

# %% [markdown]
# ## 5. Report Generation

# %%
# This section would typically involve formatting the above outputs into a structured report.
# For now, we'll save this notebook, which can be converted to HTML or PDF.

# %%
# !jupyter nbconvert --to html eda-notebook.ipynb